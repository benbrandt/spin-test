package example:composition;

// Instantiate the `spin-test-virt` component
let virt = new fermyon:spin-test-virt {...};

// Instantiate the wasi virt component
let wasi = new wasi:virt {
  ...
};

// Instantiate guest app with the key-value interface from `spin-virt`.
// All other imports and exports are kept fulfilled.
let guest = new example:guest {
  key-value: virt.key-value,
  outgoing-handler: virt.outgoing-handler,
  environment: wasi.environment,
  ...
};

// Send the guest incoming handler through the handler
let router = new fermyon:router {
  incoming-handler: guest.incoming-handler,
  ...
};

// Export handler from the guest
export router.incoming-handler;
// Also config so that the host can also control this
export virt.key-value;
export virt.http-handler;
export virt.key-value-calls;
